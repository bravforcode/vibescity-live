# VibeCity Environment Variables
# Copy this file to .env and fill in your values

# Backend
ENV="development"
PROJECT_NAME="VibeCity API"
BACKEND_CORS_ORIGINS=["http://localhost:3000","http://localhost:5173"]
MAX_CONNECTIONS=1000
# Fly API URL for frontend calls
VITE_API_URL="http://localhost:8000"
# Fly API URL + /api/v1/vibes/vibe-stream in production
VITE_WS_URL="ws://localhost:8000/api/v1/vibes/vibe-stream"

# Feature Flags
VITE_E2E=false

# Supabase
# Source: Supabase Dashboard -> Project Settings -> API -> Project URL
SUPABASE_URL="https://your-project.supabase.co"
VITE_SUPABASE_URL="https://your-project.supabase.co"
# Source: Supabase Dashboard -> API -> anon key
SUPABASE_KEY="your-anon-key"
SUPABASE_ANON_KEY="your-anon-key"
VITE_SUPABASE_ANON_KEY="your-anon-key"
# Source: Supabase Dashboard -> API -> service_role key
SUPABASE_SERVICE_ROLE_KEY="your-service-role-key"
VITE_SUPABASE_EDGE_URL="https://your-project.supabase.co/functions/v1"
SITE_URL="https://vibecity.live"

# Analytics (Supabase Edge Functions) - Recommended for production hardening
# Note: These are Supabase Edge Function secrets (set in Supabase), not Vercel env vars.
# Comma-separated fully-qualified origins (scheme + host [+ optional port]).
# If set, analytics-ingest rejects requests from all other origins.
ANALYTICS_ORIGIN_ALLOWLIST="https://vibecity.live,http://localhost:5173"
# Secret salt for hashing client IPs into analytics_sessions.ip_hash (never store raw IP).
ANALYTICS_IP_HASH_SALT="change-me-random-salt"
# Optional: restrict accepted event types (comma-separated, case-insensitive). Empty = allow all.
ANALYTICS_EVENT_ALLOWLIST=""
# Optional: max metadata payload size in bytes (defaults to 4096)
ANALYTICS_METADATA_MAX_BYTES=4096
# Optional: admin analytics limits (protects DB from heavy scans)
ANALYTICS_DASHBOARD_MAX_SESSION_ROWS=50000
ANALYTICS_DASHBOARD_MAX_EVENT_ROWS=20000

# PII Audit (Raw IP) - Enterprise audit mode
# IMPORTANT: These are Supabase Edge Function secrets (set in Supabase), not frontend env vars.
# - PII_AUDIT_ENABLED must be explicitly set to true to activate (default is fail-closed/disabled).
# - PII_AUDIT_ORIGIN_ALLOWLIST is required; requests from other origins are rejected.
# - Raw IP retention is 90 days (enforced by migration).
VITE_PII_AUDIT_ENABLED=false
PII_AUDIT_ENABLED=false
PII_AUDIT_ORIGIN_ALLOWLIST="https://vibecity.live,http://localhost:5173"
# Shared PIN required for admin PII dashboard/export (do not commit real values)
PII_AUDIT_ADMIN_PIN="change-me-pin"
# Session window (minutes) for grouping pings into one session
PII_AUDIT_SESSION_WINDOW_MINUTES=30
# Admin API limits (protects DB from heavy scans)
PII_AUDIT_DASHBOARD_MAX_ROWS=50000
PII_AUDIT_EXPORT_MAX_ROWS=5000
PII_AUDIT_ACCESS_MAX_ROWS=10000
PII_AUDIT_ACCESS_EXPORT_MAX_ROWS=5000
# CI anomaly alerts (GitHub Actions vars; not used by runtime)
PII_ACCESS_ALERT_ENABLED=true
PII_ACCESS_ALERT_WINDOW_MINUTES=60
PII_ACCESS_ALERT_TOTAL_THRESHOLD=50
PII_ACCESS_ALERT_EXPORT_THRESHOLD=10
PII_ACCESS_ALERT_PER_ACTOR_THRESHOLD=25
PII_ACCESS_ALERT_MAX_ROWS=5000
PII_ACCESS_ALERT_DEDUP_WINDOW_MINUTES=60
# SEO sitemap function
SITE_ORIGIN="https://vibecity.live"
SITEMAP_MAX_URLS=5000
# Build-time venue prerender (SEO). Defaults are safe: prerender skips if env/network is missing.
PRERENDER_ENABLED=true
PRERENDER_REQUIRED=false

# Redis (Required for Fly API/OCR/clock)
# Source: Upstash Redis connection URL
REDIS_URL="redis://default:password@your-redis-host:6379"/0"

# OCR Queue (optional)
OCR_QUEUE_STREAM="slip:ocr"
OCR_QUEUE_GROUP="slip-ocr-group"
OCR_QUEUE_CONSUMER="slip-ocr-1"

# Payments (Stripe)
STRIPE_SECRET_KEY="sk_test_..."
STRIPE_PUBLISHABLE_KEY="pk_test_..."
STRIPE_WEBHOOK_SECRET="whsec_..."

# Slip Verification (EasySlip) - Deprecated
# EasySlip is no longer used; keep for rollback only.
EASYSLIP_ACCESS_TOKEN="your-easyslip-access-token"
EASYSLIP_CHECK_DUPLICATE=true
EASYSLIP_DISABLED=true
# Optional: tighten validation to your receiver details
SLIP_EXPECT_RECEIVER_NAME="สมชาย สุวรรณเวียง"
# Allow multiple exact bank names separated by commas
SLIP_EXPECT_RECEIVER_BANKS="KBANK,ธนาคารกสิกรไทย,กสิกรไทย"
SLIP_EXPECT_RECEIVER_ACCOUNT="0113222743"
# How many trailing digits must match (handles masked accounts)
SLIP_EXPECT_RECEIVER_ACCOUNT_TAIL=4
# Disable manual review (auto-reject on verification errors)
SLIP_DISABLE_MANUAL_REVIEW=false

# Slip Verification (Google Cloud Vision OCR)
# Service account JSON (raw JSON or base64)
GCV_SERVICE_ACCOUNT_JSON="base64-or-raw-json"
GCV_PROJECT_ID="your-gcp-project-id"
GCV_OCR_MAX_BYTES=5242880
SLIP_STORE_OCR_RAW=false
SLIP_DUPLICATE_WINDOW_DAYS=90

# Slip Ops v2
IPINFO_TOKEN="your-ipinfo-token"
DISCORD_WEBHOOK_URL="https://discord.com/api/webhooks/XXXXXXXX/XXXXXXXX"
WEBHOOK_SECRET="change-me-random-secret"
SLIP_EXPORT_MAX_ROWS=5000
EASYSLIP_HEALTHCHECK_URL="https://your-public-slip-url.jpg"
EASYSLIP_HEALTHCHECK_AMOUNT=199
EASYSLIP_HEALTHCHECK_SECRET="optional-shared-secret"

# Mapbox
# Source: Mapbox Dashboard -> Access Tokens -> public token (pk...)
VITE_MAPBOX_TOKEN="pk.your-mapbox-token"

# Observability
METRICS_ENABLED=true
METRICS_AUTH_TOKEN=""
OTEL_ENABLED=false
OTEL_SERVICE_NAME="vibecity-backend"
OTEL_EXPORTER_OTLP_ENDPOINT="https://otel-collector:4318"
OTEL_TRACES_SAMPLER_ARG=0.1

# Frontend Monitoring (optional)
VITE_CLARITY_PROJECT_ID=""
VITE_SENTRY_DSN=""
VITE_SENTRY_ENABLE_DEV=false
VITE_SENTRY_TRACES_SAMPLE_RATE=0.1
VITE_SENTRY_REPLAYS_SESSION_SAMPLE_RATE=0
VITE_SENTRY_REPLAYS_ON_ERROR_SAMPLE_RATE=0

# Docker
COMPOSE_PROJECT_NAME=vibecity
